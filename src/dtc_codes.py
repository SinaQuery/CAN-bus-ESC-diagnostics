# dtc_codes.py
"""
Dictionary of known DTC codes for ESC ECU.
Each key is the 3-byte DTC integer (e.g. 0x403200),
mapped to a human-readable description from the ESC spec.
"""

DTC_MAP = {
    0x590004: "ECU Voltage Supply - High Voltage",
    0x590104: "ECU Voltage Supply - Low Voltage",
    0x500004: "ECU Hardware Error - Microcontroller",
    0x501008: "ECU Software Error - General Problem",
    0x406B06: "ABS/ESP Control - Implausible Duration",
    0x403108: "Wheel Speed Sensor Front Left - Signal Failure",
    0x403200: "Wheel Speed Sensor Front Left - Open Circuit",
    0x40A000: "Wheel Speed Sensor Front Left - Short to Ground",
    0x40A100: "Wheel Speed Sensor Front Left - Short to Battery",
    0x40A900: "Wheel Speed Sensor Front Left - General Error",
    0x403408: "Wheel Speed Sensor Front Right - Signal Failure",
    0x403500: "Wheel Speed Sensor Front Right - Open Circuit",
    0x40A200: "Wheel Speed Sensor Front Right - Short to Ground",
    0x40A300: "Wheel Speed Sensor Front Right - Short to Battery",
    0x40AA00: "Wheel Speed Sensor Front Right - General Error",
    0x403708: "Wheel Speed Sensor Rear Left - Signal Failure",
    0x403800: "Wheel Speed Sensor Rear Left - Open Circuit",
    0x40A400: "Wheel Speed Sensor Rear Left - Short to Ground",
    0x40A500: "Wheel Speed Sensor Rear Left - Short to Battery",
    0x40AB00: "Wheel Speed Sensor Rear Left - General Error",
    0x403A08: "Wheel Speed Sensor Rear Right - Signal Failure",
    0x403B00: "Wheel Speed Sensor Rear Right - Open Circuit",
    0x40A600: "Wheel Speed Sensor Rear Right - Short to Ground",
    0x40A700: "Wheel Speed Sensor Rear Right - Short to Battery",
    0x40AC00: "Wheel Speed Sensor Rear Right - General Error",
    0x509904: "Wheel Speed Sensor - Generic Error",
    0x404460: "Pressure Sensor - Signal Fault",
    0x404510: "Pressure Sensor - Line Fault",
    0x404008: "Brake Light Switch - Plausibility Error",
    0xD60108: "Brake Light Switch - CAN Signal Invalid",
    0x406108: "Lateral Acceleration Sensor - Signal Fault",
    0x406208: "Longitudinal Acceleration Sensor - Signal Fault",
    0x406308: "Yaw Rate Sensor - Signal Fault",
    0x419604: "Yaw Rate Sensor Cluster - Hardware Fault",
    0x40A800: "Yaw Rate Sensor Cluster - Calibration Failed",
    0xC00500: "CAN Bus - Overvoltage",
    0xC00700: "CAN Bus - Undervoltage",
    0x500104: "CAN Hardware Error",
    0xC00104: "CAN Bus Off Error",
    0xD00104: "CAN Error Passive",
    0xC10004: "CAN Timeout - EMS",
    0xC10008: "CAN Data Corrupt - EMS",
    0x506600: "Steering Angle Sensor - Calibration Error",
    0x446008: "Steering Angle Sensor - Signal Fault",
    0xC12604: "CAN Timeout - SAS",
    0xC12608: "CAN Data Corrupt - SAS",
    0xC10104: "CAN Timeout - TCU",
    0xC10108: "CAN Data Corrupt - TCU",
    0x401004: "Valve Fault - Inlet FL",
    0x401104: "Valve Fault - Outlet FL",
    0x401404: "Valve Fault - Inlet FR",
    0x401504: "Valve Fault - Outlet FR",
    0x401804: "Valve Fault - Inlet RL",
    0x401904: "Valve Fault - Outlet RL",
    0x401C04: "Valve Fault - Inlet RR",
    0x401D04: "Valve Fault - Outlet RR",
    0x400104: "Valve Fault - USV1",
    0x400204: "Valve Fault - USV2",
    0x400304: "Valve Fault - HSV1",
    0x400404: "Valve Fault - HSV2",
    0x509504: "Valve Relay Error",
    0x402004: "Return Pump Fault",
    0x407208: "General Valve Fault",
    0x504C04: "PATA Switch Failure",
    0x521208: "Variant Coding Error",
    0xD60208: "Handbrake Signal - CAN Invalid",
    0x500300: "Clutch Switch Error",
    0xD60308: "Clutch Signal - CAN Invalid",
    0xD60408: "Reverse Gear Switch - CAN Invalid",
    0x508C08: "Reverse Gear Switch - Permanent High/Low",
    0xC12308: "Lost Communication - Yaw Rate Sensor Module",
    0xC51308: "Invalid Data - Yaw Rate Sensor Module",
    0x406102: "External YRS - Lateral Acceleration Sensor Fault",
    0x406202: "External YRS - Longitudinal Acceleration Sensor Fault",
    0x406302: "External YRS - Yaw Rate Sensor Fault",
    0xC14008: "CAN Timeout - BCM",
    0xC14004: "CAN Data Corrupt - BCM",
    0xC14608: "CAN Timeout - Gateway",
    0xC14604: "CAN Data Corrupt - Gateway",
}


def decode_status(status):
    if status & 0x20: return {"flags": "Warning Lamp On", "severity": "Critical"}
    if status & 0x08: return {"flags": "Confirmed", "severity": "Major"}
    if status & 0x04: return {"flags": "Pending", "severity": "Minor"}
    if status & 0x01: return {"flags": "Test Failed", "severity": "Info"}
    return {"flags": "No flags", "severity": "None"}